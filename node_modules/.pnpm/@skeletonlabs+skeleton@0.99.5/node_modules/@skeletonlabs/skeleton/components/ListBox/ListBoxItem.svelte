<script>import { createEventDispatcher, getContext } from "svelte";
export let id = "";
const dispatch = createEventDispatcher();
export let selected = getContext("selected");
export let accent = getContext("accent");
export let padding = getContext("padding");
export let rounded = getContext("rounded");
export let hover = getContext("hover");
const cBase = "flex items-center space-x-4 whitespace-nowrap cursor-pointer -outline-offset-[3px]";
let elemItem;
function onClickHandler(event) {
  if (!$$props.value)
    return;
  Array.isArray($selected) === true ? handleMultiSelect() : handleSingleSelect();
  dispatch("click", event);
}
function handleSingleSelect() {
  selected.set($$props.value);
}
function handleMultiSelect() {
  const v = $$props.value;
  const local = $selected;
  if (local.includes(v)) {
    local.splice(local.indexOf(v), 1);
    selected.set(local);
  } else {
    selected.set([...local, v]);
  }
}
function onKeyDown(event) {
  dispatch("keydown", event);
  if (["Enter", "Space"].includes(event.code)) {
    event.preventDefault();
    elemItem.click();
  }
}
$:
  selectionMatch = () => {
    if ($selected && $$props.value) {
      return typeof $selected === "object" ? $selected.includes($$props.value) : $selected === $$props.value;
    }
    return false;
  };
$:
  isSelected = selectionMatch() ? true : false;
$:
  classesHighlight = isSelected ? `${accent}` : `${hover}`;
$:
  classesBase = `${cBase} ${padding} ${rounded} ${classesHighlight} ${$$props.class ?? ""}`;
</script>

<!-- prettier-ignore -->
<li
	bind:this={elemItem}
	class="listbox-item {classesBase}"
	{id}
	on:click={onClickHandler}
	on:keydown={onKeyDown}
	on:keyup
	on:keypress
	role="option"
	aria-selected={isSelected}
	tabindex="0"
	data-testid="listbox-item"
>
	<!-- Slot: Lead -->
	{#if $$slots.lead}<span class="listbox-item-lead"><slot name="lead" /></span>{/if}
	<!-- Slot: Default -->
	<div class="listbox-item-content flex-1"><slot /></div>
	<!-- Slot: Trail -->
	{#if $$slots.trail}<span class="listbox-item-trail"><slot name="trail" /></span>{/if}
</li>

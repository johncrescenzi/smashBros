<script>import { fly } from "svelte/transition";
import { toastStore } from "./stores";
export let position = "b";
export let max = 3;
export let duration = 150;
export let background = "bg-secondary-500";
export let width = "max-w-[640px]";
export let color = "text-on-secondary-token";
export let padding = "p-4";
export let spacing = "space-x-4";
export let rounded = "rounded-container-token";
export let shadow = "shadow-lg";
export let buttonAction = "variant-filled";
export let buttonDismiss = "variant-filled";
const cWrapper = "flex fixed top-0 left-0 right-0 bottom-0 z-[888] pointer-events-none";
const cSnackbar = "flex flex-col space-y-2";
const cToast = "flex justify-between items-center pointer-events-auto";
let cPosition;
let cAlign;
let animAxis = { x: 0, y: 0 };
switch (position) {
  case "t":
    cPosition = "justify-center items-start";
    cAlign = "items-center";
    animAxis = { x: 0, y: -100 };
    break;
  case "b":
    cPosition = "justify-center items-end";
    cAlign = "items-center";
    animAxis = { x: 0, y: 100 };
    break;
  case "l":
    cPosition = "justify-start items-center";
    cAlign = "items-start";
    animAxis = { x: -100, y: 0 };
    break;
  case "r":
    cPosition = "justify-end items-center";
    cAlign = "items-end";
    animAxis = { x: 100, y: 0 };
    break;
  case "tl":
    cPosition = "justify-start items-start";
    cAlign = "items-start";
    animAxis = { x: -100, y: 0 };
    break;
  case "tr":
    cPosition = "justify-end items-start";
    cAlign = "items-end";
    animAxis = { x: 100, y: 0 };
    break;
  case "bl":
    cPosition = "justify-start items-end";
    cAlign = "items-start";
    animAxis = { x: -100, y: 0 };
    break;
  case "br":
    cPosition = "justify-end items-end";
    cAlign = "items-end";
    animAxis = { x: 100, y: 0 };
    break;
}
function onAction(index) {
  $toastStore[index]?.action?.response();
  toastStore.close($toastStore[index].id);
}
$:
  classesWrapper = `${cWrapper} ${cPosition} ${$$props.class || ""}`;
$:
  classesSnackbar = `${cSnackbar} ${cAlign} ${padding}`;
$:
  classesBase = `${cToast} ${background} ${width} ${color} ${padding} ${spacing} ${rounded} ${shadow}`;
</script>

{#if $toastStore.length}
	<!-- Wrapper -->
	<div class="snackbar-wrapper {classesWrapper}" data-testid="snackbar-wrapper">
		<!-- List -->
		<div class="snackbar {classesSnackbar}" transition:fly={{ x: animAxis.x, y: animAxis.y, duration }}>
			{#each $toastStore as t, i}
				{#if i < max + 1}
					<!-- Toast -->
					<div class="toast {classesBase} {t.classes}" role="alert" aria-live="polite" data-testid="toast">
						<div class="text-base">{@html t.message}</div>
						<!-- prettier-ignore -->
						<div class="flex items-center space-x-2">
							{#if t.action}<button class="btn {buttonAction}" on:click={() => onAction(i)}>{@html t.action.label}</button>{/if}
							<button class="btn-icon {buttonDismiss}" on:click={() => { toastStore.close(t.id) }}>âœ•</button>
						</div>
					</div>
				{/if}
			{/each}
		</div>
	</div>
{/if}
